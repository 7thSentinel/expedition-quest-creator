// https://www.gstatic.com/realtime/realtime-client-utils.js
window.utils={},utils.RealtimeUtils=function(a){this.init(a)},utils.RealtimeUtils.prototype={clientId:null,mimeType:"application/vnd.google-apps.drive-sdk",refreshInterval:18e5,scopes:["https://www.googleapis.com/auth/drive.install","https://www.googleapis.com/auth/drive.file"],init:function(a){this.mergeOptions(a),this.authorizer=new utils.RealtimeAuthorizer(this),this.createRealtimeFile=this.createRealtimeFile.bind(this)},authorize:function(a,b){this.authorizer.start(a,b)},mergeOptions:function(a){for(var b in a)this[b]=a[b]},getParam:function(a){var b=new RegExp(a+"=(.*?)($|&)","g"),c=window.location.search.match(b);return c&&c.length?(c=c[0],c=c.replace(a+"=","").replace("&","")):c=null,c},createRealtimeFile:function(a,b){var c=this;window.gapi.client.load("drive","v2",function(){var d={resource:{mimeType:c.mimeType,title:a}};window.gapi.client.drive.files.insert(d).execute(b)})},load:function(a,b,c){window.gapi.drive.realtime.load(a,function(a){window.doc=a,b(a)},c,this.onError)},onError:function(a){a.type==window.gapi.drive.realtime.ErrorType.TOKEN_REFRESH_REQUIRED?this.authorizer.authorize(function(){console.log("Error, auth refreshed")},!1):a.type==window.gapi.drive.realtime.ErrorType.CLIENT_ERROR?(alert("An Error happened: "+a.message),window.location.href="/"):a.type==window.gapi.drive.realtime.ErrorType.NOT_FOUND?(alert("The file was not found. It does not exist or you do not have read access to the file."),window.location.href="/"):a.type==window.gapi.drive.realtime.ErrorType.FORBIDDEN&&(alert("You do not have access to this file. Try having the owner shareit with you from Google Drive."),window.location.href="/")}},utils.RealtimeAuthorizer=function(a){this.util=a,this.handleAuthResult=this.handleAuthResult.bind(this),this.token=null},utils.RealtimeAuthorizer.prototype={start:function(a,b){var c=this;window.gapi.load("auth:client,drive-realtime,drive-share",{callback:function(){c.authorize(a,b)}}),this.authTimer&&window.clearTimeout(this.authTimer),this.refreshAuth()},authorize:function(a,b){this.onAuthComplete=a,window.gapi.auth.authorize({client_id:this.util.clientId,scope:this.util.scopes,immediate:!b},this.handleAuthResult)},handleAuthResult:function(a){a&&!a.error&&(this.token=a.access_token),this.onAuthComplete(a)},refreshAuth:function(){var a=this;this.authTimer=setTimeout(function(){a.authorize(function(){console.log("Refreshed Auth Token")},!1),a.refreshAuth()},this.util.refreshInterval)}};
